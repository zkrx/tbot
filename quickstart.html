

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quick Start &mdash; tbot 0.8.3-0-g1e4eea4 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/tbot-logo-white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.8.3-0-g1e4eea4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#commandline">Commandline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testcases">Testcases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#machines">Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#machine-classes">Machine-Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-interaction">Hardware Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-use-from-tests">Hardware Use from Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migrating from tbot 0.7.1</a></li>
</ul>
<p class="caption"><span class="caption-text">Core Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/main.html"><code class="docutils literal notranslate"><span class="pre">tbot</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/log.html"><code class="docutils literal notranslate"><span class="pre">tbot.log</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_linux.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.linux</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_board.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.board</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_connector.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.connector</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_shell.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.shell</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_channel.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.channel</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/selectable.html"><code class="docutils literal notranslate"><span class="pre">tbot.selectable</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Testcase Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/tc.html"><code class="docutils literal notranslate"><span class="pre">tbot.tc</span></code> - Builtin Testcases</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/connector.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.connector</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/swupdate.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.swupdate</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/timing.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.timing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/utils.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.utils</span></code></a></li>
</ul>
<p class="caption"><span class="caption-text">Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing to tbot</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">tbot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quick Start</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
            
  <div class="section" id="quick-start">
<span id="quickstart"></span><h1>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<div class="section" id="commandline">
<h2>Commandline<a class="headerlink" href="#commandline" title="Permalink to this headline">¶</a></h2>
<p>First of all, install tbot.  Instructions are here: <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installation</span></a>.</p>
<p>Let’s get started!  To check if the installation went smoothly, try running tbot’s selftests:</p>
<div class="highlight">
<pre>bash-4.4$ tbot selftest
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>selftest</b></font> ...
│   ├─Calling <font color="#A1EFE4"><b>testsuite</b></font> ...
│   │   ├─Calling <font color="#A1EFE4"><b>selftest_failing</b></font> ...
│   │   │   ├─Calling <font color="#A1EFE4"><b>inner</b></font> ...
│   │   │   │   └─<font color="#F92672"><b>Fail</b></font>. (0.000s)
│   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.001s)
│   │   ├─Calling <font color="#A1EFE4"><b>selftest_uname</b></font> ...
│   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.003s)
│   │   ├─Calling <font color="#A1EFE4"><b>selftest_user</b></font> ...
│   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.001s)
[...]
│   │   ├─Calling <font color="#A1EFE4"><b>selftest_board_linux</b></font> ...
│   │   │   ├─<font color="#F4BF75"><b>Skipped</b></font> because no board available.
│   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.000s)
[...]
│   │   ├─Calling <font color="#A1EFE4"><b>selftest_board_linux_bad_console</b></font> ...
│   │   │   ├─<b>POWERON</b> (test)
│   │   │   ├─<b>LINUX</b> (test-linux)
│   │   │   ├─<b>POWEROFF</b> (test)
│   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.460s)
│   │   ├─────────────────────────────────────────
│   │   │ <font color="#A6E22E"><b>Success</b></font>: 17/17 tests passed
│   │   └─<font color="#A6E22E"><b>Done</b></font>. (4.675s)
│   └─<font color="#A6E22E"><b>Done</b></font>. (4.742s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (4.845s)</pre>
</div><p>If you feel adventurous, there are even more selftests that check if the built-in testcases
work as intended:</p>
<div class="highlight">
<pre>bash-4.4$ tbot selftest_tc
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>selftest_tc</b></font> ...
│   ├─Calling <font color="#A1EFE4"><b>testsuite</b></font> ...
│   │   ├─Calling <font color="#A1EFE4"><b>selftest_tc_git_checkout</b></font> ...
│   │   │   ├─Calling <font color="#A1EFE4"><b>git_prepare</b></font> ...
│   │   │   │   ├─Setting up test repo ...
│   │   │   │   ├─Calling <font color="#A1EFE4"><b>commit</b></font> ...
│   │   │   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.009s)
│   │   │   │   ├─Creating test patch ...
│   │   │   │   ├─Calling <font color="#A1EFE4"><b>commit</b></font> ...
│   │   │   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.004s)
│   │   │   │   ├─Resetting repo ...
│   │   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.126s)
│   │   │   ├─Cloning repo ...
│   │   │   ├─Make repo dirty ...
│   │   │   ├─Add dirty commit ...
│   │   │   ├─Calling <font color="#A1EFE4"><b>commit</b></font> ...
│   │   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.004s)
│   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.321s)
[...]
│   │   ├─Calling <font color="#A1EFE4"><b>selftest_tc_build_toolchain</b></font> ...
│   │   │   ├─Creating dummy toolchain ...
│   │   │   ├─Attempt using it ...
│   │   │   └─<font color="#A6E22E"><b>Done</b></font>. (0.153s)
│   │   ├─────────────────────────────────────────
│   │   │ <font color="#A6E22E"><b>Success</b></font>: 6/6 tests passed
│   │   └─<font color="#A6E22E"><b>Done</b></font>. (3.679s)
│   └─<font color="#A6E22E"><b>Done</b></font>. (3.764s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (3.894s)</pre>
</div><p>tbot also allows you to run multiple testcases at once:</p>
<div class="highlight">
<pre>bash-4.4$ tbot selftest selftest_tc
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>selftest</b></font> ...
│   ├─Calling <font color="#A1EFE4"><b>testsuite</b></font> ...
[...]
│   │   ├─────────────────────────────────────────
│   │   │ <font color="#A6E22E"><b>Success</b></font>: 17/17 tests passed
│   │   └─<font color="#A6E22E"><b>Done</b></font>. (4.788s)
│   └─<font color="#A6E22E"><b>Done</b></font>. (4.873s)
├─Calling <font color="#A1EFE4"><b>selftest_tc</b></font> ...
│   ├─Calling <font color="#A1EFE4"><b>testsuite</b></font> ...
[...]
│   │   ├─────────────────────────────────────────
│   │   │ <font color="#A6E22E"><b>Success</b></font>: 6/6 tests passed
│   │   └─<font color="#A6E22E"><b>Done</b></font>. (3.390s)
│   └─<font color="#A6E22E"><b>Done</b></font>. (3.459s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (8.453s)</pre>
</div><p>If you want an overview of the available testcases, use this command:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tbot --list-testcases
</pre></div>
</div>
<hr class="docutils" />
<p>The output you saw during the testcase runs was just a rough overview of what is going on.  That
might not be detailed enough for you.  By adding <code class="docutils literal notranslate"><span class="pre">-v</span></code>, tbot will show all commands as they are
executed.  Add another one: <code class="docutils literal notranslate"><span class="pre">-vv</span></code> and you will also see command outputs!</p>
<div class="highlight">
<pre>bash-4.4$ tbot selftest_path_stat -vv
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>selftest_path_stat</b></font> ...
│   ├─Setting up test files ...
[...]
│   ├─[<font color="#F4BF75">local</font>] test -S /tmp/tbot-wd/nonexistent
│   ├─Checking stat results ...
│   ├─[<font color="#F4BF75">local</font>] stat -t /dev
│   │    ## /dev 4060 0 41ed 0 0 6 1025 20 0 0 1547723442 1547715500 1547715500 0 4096 system_u:object_r:device_t:s0
[...]
│   └─<font color="#A6E22E"><b>Done</b></font>. (0.145s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (0.278s)</pre>
</div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is one more verbosity level: <code class="docutils literal notranslate"><span class="pre">-vvv</span></code>.  This is for debugging, if something doesn’t quite work.
It shows you all communication happening, both directions.  Try it if you want to, but be prepared:
It will look quite messy!</p>
</div>
<p>One more commandline feature before we dive into python code:  If you are afraid of a destructive
command, you can run tbot with <code class="docutils literal notranslate"><span class="pre">--interactive</span></code>:</p>
<div class="highlight">
<pre>bash-4.4$ tbot selftest_uname -vi
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>selftest_uname</b></font> ...
│   ├─[<font color="#F4BF75">local</font>] uname -a
<font color="#AE81FF">OK [Y/n]? </font>Y
│   └─<font color="#A6E22E"><b>Done</b></font>. (2.721s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (2.848s)</pre>
</div><p>Now tbot will kindly ask you before running each command!  (See? <code class="docutils literal notranslate"><span class="pre">-emacs</span></code> wouldn’t answer as nicely!)</p>
</div>
<div class="section" id="testcases">
<h2>Testcases<a class="headerlink" href="#testcases" title="Permalink to this headline">¶</a></h2>
<p>Ok, commandline isn’t all that fun.  Let’s dive deeper!  Some code please!</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="n">tbot</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This is tbot’s hello world.  Stick this code into a file named <code class="docutils literal notranslate"><span class="pre">tc.py</span></code>.  Now, if you check the list
of testcases (<code class="docutils literal notranslate"><span class="pre">tbot</span> <span class="pre">--list-testcases</span></code>), <code class="docutils literal notranslate"><span class="pre">hello_world</span></code> pops up.  Run it!</p>
<div class="highlight">
<pre>bash-4.4$ tbot hello_world
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>hello_world</b></font> ...
│   ├─Hello World!
│   └─<font color="#A6E22E"><b>Done</b></font>. (0.000s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (0.127s)</pre>
</div><p>Hello tbot!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I am sure at least one person reading this will be offended by being told how to name their file.
Why <code class="docutils literal notranslate"><span class="pre">tc.py</span></code>?  I prefer calling it <code class="docutils literal notranslate"><span class="pre">my_most_amazing_testcases.py</span></code>!</p>
<p>Fear not, you can do just that!  You just need to tell tbot about it.  Instead of the above
command, run:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tbot -t my_most_amazing_testcases.py hello_world
</pre></div>
</div>
<p>You can also include all python files in a directory with <code class="docutils literal notranslate"><span class="pre">-T</span></code>.</p>
</div>
<p>Well, before writing actual tests, I need to explain a few things:  In tbot, testcases are basically
python functions.  This means you can call them just like python functions!  From other testcases!
How about the following?</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tbot</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!!&quot;</span><span class="p">)</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">greet_tbot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">greet</span><span class="p">(</span><span class="s2">&quot;tbot&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>If you now call <code class="docutils literal notranslate"><span class="pre">greet_tbot</span></code>, you can see in the output that it calls <code class="docutils literal notranslate"><span class="pre">greet</span></code>.</p>
<p>But wait! If you try calling <code class="docutils literal notranslate"><span class="pre">greet</span></code> directly, it fails!  Of course, because <code class="docutils literal notranslate"><span class="pre">greet</span></code> has a
parameter.  As previously mentioned, testcases are python functions, so naturally, they can also have
parameters.  There are two ways to “fix” this:</p>
<ol class="arabic">
<li><p>Specifying a default value for the parameter:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;World&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tbot</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!!&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>Setting a value for the parameter!  That’s right, you can set the parameter from the commandline.  It looks
like this:</p>
<div class="highlight">
<pre>bash-4.4$ tbot greet -p name=\&quot;tbot\&quot;
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─<b>Parameters:</b>
│     name       = <font color="#F4BF75">&apos;tbot&apos;</font>
├─Calling <font color="#A1EFE4"><b>greet</b></font> ...
│   ├─Hello tbot!!
│   └─<font color="#A6E22E"><b>Done</b></font>. (0.000s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (0.238s)</pre>
</div><p>Note the escaped quotes around <code class="docutils literal notranslate"><span class="pre">\&quot;tbot\&quot;</span></code>.  They are necessary because the value is <cite>eval()</cite>-uated
internally.  This is done to allow you to set values of any type with ease.  Any python
expression goes!  (Also evil ones, be careful …)</p>
</li>
</ol>
<p>As you’ll see later on, there are cases where you should have default values and ones where
it doesn’t make sense.  You’ll have to decide individually …</p>
<p>One more thing:  You’d expect a testcase to somehow be able to show whether it succeeded.  In tbot,
a testcase that returns normally passes and one that raises an <code class="docutils literal notranslate"><span class="pre">Exception</span></code> has failed.  This is
pretty convenient:  You can easily catch failures by using a try-block and your testcases will also
automatically fail if anything unexpected happens.</p>
</div>
<div class="section" id="machines">
<h2>Machines<a class="headerlink" href="#machines" title="Permalink to this headline">¶</a></h2>
<p>Next up: Machines!  Machines are what tbot is made for.  Let’s take a look at the diagram from the
landing page again:</p>
<img alt="_images/tbot.svg" src="_images/tbot.svg" /><p>Lab-host? It’s a machine! Buildhost?  Just as well!  The boards you are testing?  You guessed it!</p>
<p>Let’s start simple though:  Just run a command on the lab-host:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">greet_user</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_lab</span><span class="p">()</span> <span class="k">as</span> <span class="n">lh</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">lh</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;--user&quot;</span><span class="p">,</span> <span class="s2">&quot;--name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">tbot</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Now try:</p>
<div class="highlight">
<pre>bash-4.4$ tbot greet_user -v
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>greet_user</b></font> ...
│   ├─[<font color="#F4BF75">local</font>] id --user --name
│   ├─Hello hws!
│   └─<font color="#A6E22E"><b>Done</b></font>. (0.070s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (0.173s)</pre>
</div><p>As you can see, tbot ran <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">--user</span> <span class="pre">--name</span></code> to find your name.  You might be curious about the <code class="docutils literal notranslate"><span class="pre">[local]</span></code>
part: That’s the machine tbot ran the command on.  By default, the lab-host is your localhost. We’ll
see later how to change that.</p>
<p>There are quite a few new things in the sample above.  Let’s go through them one by one:</p>
<ul class="simple">
<li><p><a class="reference internal" href="modules/main.html#tbot.acquire_lab" title="tbot.acquire_lab"><code class="xref py py-func docutils literal notranslate"><span class="pre">tbot.acquire_lab()</span></code></a>: This is a function provided by tbot that returns the selected lab-host.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">tbot.acquire_lab()</span> <span class="pre">as</span> <span class="pre">lh:</span></code>: Each machine is a context manager.  To get access, you need
to enter its context and as soon as you leave it the connection is destroyed.  If you haven’t
heard about context managers before, take a look at <a class="reference external" href="https://jeffknupp.com/blog/2016/03/07/python-with-context-managers/">Python with Context Managers</a>.  They are really useful!</p></li>
<li><p><a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.LinuxShell.exec0" title="tbot.machine.linux.LinuxShell.exec0"><code class="xref py py-meth docutils literal notranslate"><span class="pre">lh.exec0()</span></code></a>:  This is a function to run a command.
Specifically <strong>exec</strong>-utes it and checks whether the return value is <code class="docutils literal notranslate"><span class="pre">0</span></code>.  There are also others, for
example, <a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.LinuxShell.test" title="tbot.machine.linux.LinuxShell.test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">lh.test()</span></code></a> which returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the command
succeeded and <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p></li>
<li><p>All command executing methods take one parameter per commandline argument.  Each one will be properly
escaped:  <code class="docutils literal notranslate"><span class="pre">lh.exec0(&quot;echo&quot;,</span> <span class="pre">&quot;!?#;&gt;&amp;&lt;&quot;)</span></code> would print <code class="docutils literal notranslate"><span class="pre">!?#;&gt;&amp;&lt;</span></code>, no manual quoting needed!</p></li>
<li><p><a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.LinuxShell.exec0" title="tbot.machine.linux.LinuxShell.exec0"><code class="xref py py-meth docutils literal notranslate"><span class="pre">lh.exec0()</span></code></a> returns a string which I call <code class="docutils literal notranslate"><span class="pre">.strip()</span></code>
on.  The reason is that most commands include a trailing newline (<code class="docutils literal notranslate"><span class="pre">\n</span></code>).  I don’t want that in the
name so I remove it.</p></li>
</ul>
<p>To learn more about the methods tbot provides for interacting with linux-machines, take a look at the
docs for <a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.LinuxShell" title="tbot.machine.linux.LinuxShell"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinuxShell</span></code></a>.</p>
<p>One more feature I want to mention in this quick guide:  Most machines have an
<a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.LinuxShell.interactive" title="tbot.machine.linux.LinuxShell.interactive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">interactive()</span></code></a> method.  This method will connect the
channel to the terminal and allows you to directly enter commands.  You can use it to make tbot
do some work, then do something manually.  Like a symbiotic development process.  It really makes
you a lot more productive if you embrace this idea!  There is also a testcase to call it from the
commandline:</p>
<div class="highlight">
<pre>bash-4.4$ tbot interactive_lab
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>interactive_lab</b></font> ...
│   ├─Entering interactive shell ...

<font color="#A1EFE4">local: </font><font color="#A6E22E">/tmp</font>&gt; whoami
hws
<font color="#A1EFE4">local: </font><font color="#A6E22E">/tmp</font>&gt; exit

│   ├─Exiting interactive shell ...
│   └─<font color="#A6E22E"><b>Done</b></font>. (49.746s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (49.851s)</pre>
</div></div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Up until now we did everything on our localhost.  That’s boring!  tbot allows you to easily use a
lab-host that you can connect to via SSH for example.  To do that you have to write a small config
file.  There’s a twist though!  The config file is actually a python module.  In this module, you
create a class for your lab-host.  If you have some special features on your lab-host you can add
them in there just as well!</p>
<p>The simplest config (for a lab-host connected via SSH) looks like this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>
<span class="kn">from</span> <span class="nn">tbot.machine</span> <span class="kn">import</span> <span class="n">connector</span><span class="p">,</span> <span class="n">linux</span>

<span class="k">class</span> <span class="nc">AwesomeLab</span><span class="p">(</span>
    <span class="n">connector</span><span class="o">.</span><span class="n">ParamikoConnector</span><span class="p">,</span>
    <span class="n">linux</span><span class="o">.</span><span class="n">Bash</span><span class="p">,</span>
    <span class="n">linux</span><span class="o">.</span><span class="n">Lab</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;awesome-lab&quot;</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;awesome.lab.com&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">linux</span><span class="o">.</span><span class="n">Workdir</span><span class="o">.</span><span class="n">athome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;tbot-workdir&quot;</span><span class="p">)</span>


<span class="c1"># tbot will check for `LAB`, don&#39;t forget to set it!</span>
<span class="n">LAB</span> <span class="o">=</span> <span class="n">AwesomeLab</span>
</pre></div>
</td></tr></table></div>
<p>Of course, you’ll have to adjust this a little.  tbot will try to connect to the host <code class="docutils literal notranslate"><span class="pre">hostname</span></code>.
It will query <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> for a <code class="docutils literal notranslate"><span class="pre">username</span></code> and key.  (You need to be able to connect
to <code class="docutils literal notranslate"><span class="pre">hostname</span></code> without a password!)</p>
<p>Try using your config now!</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tbot -l &lt;name-of-lab-config&gt;.py interactive_lab
</pre></div>
</div>
<p>Congratulations! You now have a remote session on your lab-host!  You could also run some selftest to verify
that tbot can run these commands on your new lab-host as well:</p>
<div class="highlight">
<pre>bash-4.4$ tbot -l lab.py selftest_path_integrity -vv
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>selftest_path_integrity</b></font> ...
│   ├─Logging in on <font color="#F4BF75">hws@78.79.32.85:22</font> ...
│   ├─[<font color="#F4BF75">awesome-lab</font>] echo ${HOME}
│   │    ## /home/hws
│   ├─[<font color="#F4BF75">awesome-lab</font>] test -d /home/hws/tbot-workdir
│   ├─[<font color="#F4BF75">awesome-lab</font>] mkdir -p /home/hws/tbot-workdir
│   ├─Logging in on <font color="#F4BF75">hws@78.79.32.85:22</font> ...
│   ├─[<font color="#F4BF75">awesome-lab</font>] mkdir -p /home/hws/tbot-workdir/folder
│   ├─[<font color="#F4BF75">awesome-lab</font>] test -d /home/hws/tbot-workdir/folder
│   ├─[<font color="#F4BF75">awesome-lab</font>] uname -a &gt;/home/hws/tbot-workdir/folder/file.txt
│   ├─[<font color="#F4BF75">awesome-lab</font>] test -f /home/hws/tbot-workdir/folder/file.txt
│   ├─[<font color="#F4BF75">awesome-lab</font>] rm -r /home/hws/tbot-workdir/folder
│   ├─[<font color="#F4BF75">awesome-lab</font>] test -e /home/hws/tbot-workdir/folder/file.txt
│   ├─[<font color="#F4BF75">awesome-lab</font>] test -e /home/hws/tbot-workdir/folder
│   └─<font color="#A6E22E"><b>Done</b></font>. (2.833s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (2.959s)</pre>
</div><p>As you can see, now it says <code class="docutils literal notranslate"><span class="pre">[awesome-lab]</span></code> in front of the commands.  tbot is running commands
remotely!</p>
<p>This was just a simple example … Configs can get a lot bigger and a lot more complex.  Take a
look at the <a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration</span></a> documentation for more info!</p>
</div>
<div class="section" id="machine-classes">
<h2>Machine-Classes<a class="headerlink" href="#machine-classes" title="Permalink to this headline">¶</a></h2>
<p>When configuring the lab-host we already saw the definition of a machine class, but up to now I did
not really explain how those actually work.  Before we can dive into the next chapter, I have to
explain a bit about this:</p>
<p>tbot machines are classes which inherit from multiple components.  This allows easy mix and matching
to flexibly configure the machine for your needs.  There are two main components which every machine
needs and a number of mixins which allow further customization.  First the big ones:</p>
<ol class="arabic simple">
<li><p><strong>Connectors</strong> define how a connection to the respective machine can be established.  The easiest
way is the <a class="reference internal" href="modules/machine_connector.html#tbot.machine.connector.SubprocessConnector" title="tbot.machine.connector.SubprocessConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubprocessConnector</span></code></a> which just spawns a shell as a
subprocess.  More complex examples include the <a class="reference internal" href="modules/machine_connector.html#tbot.machine.connector.ParamikoConnector" title="tbot.machine.connector.ParamikoConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParamikoConnector</span></code></a>
which we saw above, or the <a class="reference internal" href="modules/machine_connector.html#tbot.machine.connector.ConsoleConnector" title="tbot.machine.connector.ConsoleConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConsoleConnector</span></code></a>.  For more
in-depth documentation of the connectors, take a look at the <a class="reference internal" href="modules/machine_connector.html#module-tbot.machine.connector" title="tbot.machine.connector"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tbot.machine.connector</span></code></a>
module.</p></li>
<li><p><strong>Shells</strong> define the API for interacting with the machine.  This varies quite drastically
between the different machine-types as shells behave differently.  Think how the U-Boot
environment works completely different than the environment in Linux.  The lab-host config
above used the <a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.Bash" title="tbot.machine.linux.Bash"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bash</span></code></a> shell and we will see a
<a class="reference internal" href="modules/machine_board.html#tbot.machine.board.UBootShell" title="tbot.machine.board.UBootShell"><code class="xref py py-class docutils literal notranslate"><span class="pre">UBootShell</span></code></a> in the next chapter.  For further details, go to the
<a class="reference internal" href="modules/machine_shell.html#module-tbot.machine.shell" title="tbot.machine.shell"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tbot.machine.shell</span></code></a> module.</p></li>
</ol>
<p>Between those two, sometimes you need a third part, a so-called <strong>Initializer</strong>.  An example for a
situation where one is needed would be this:  After opening the serial connection to your board, you
want to wait for the login-prompt first and enter your credentials before the shell is available.
For this, tbot provides a <a class="reference internal" href="modules/machine_board.html#tbot.machine.board.LinuxBootLogin" title="tbot.machine.board.LinuxBootLogin"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinuxBootLogin</span></code></a> initializer.  If you have
multiple initializers in a machine-class, you need to keep in mind in which order they should run.</p>
<p>As a final part, there are some mixins for certain uses.  For example the
<a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.Lab" title="tbot.machine.linux.Lab"><code class="xref py py-class docutils literal notranslate"><span class="pre">Lab</span></code></a> mixin which marks a machine as a lab-host or the
<a class="reference internal" href="modules/machine_linux.html#tbot.machine.linux.Builder" title="tbot.machine.linux.Builder"><code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code></a> mixin which marks a machine as a build-host.  These can be
added whenever appropriate.</p>
<p>More details about machine-classes can be found in the <a class="reference internal" href="modules/machine.html#module-tbot.machine" title="tbot.machine"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tbot.machine</span></code></a> module.</p>
</div>
<div class="section" id="hardware-interaction">
<h2>Hardware Interaction<a class="headerlink" href="#hardware-interaction" title="Permalink to this headline">¶</a></h2>
<p>We haven’t even talked to actual hardware yet!  Let’s change that.  Unfortunately, as each device
is different, you’ll have to figure out a few things yourself.</p>
<p>First Step:  Another config file.  The board needs to be configured in a second file.  Let’s
start simple:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>
<span class="kn">from</span> <span class="nn">tbot.machine</span> <span class="kn">import</span> <span class="n">board</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span> <span class="n">linux</span>

<span class="k">class</span> <span class="nc">SomeBoard</span><span class="p">(</span>
    <span class="n">connector</span><span class="o">.</span><span class="n">ConsoleConnector</span><span class="p">,</span>
    <span class="n">board</span><span class="o">.</span><span class="n">PowerControl</span><span class="p">,</span>
    <span class="n">board</span><span class="o">.</span><span class="n">Board</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;some-board&quot;</span>

    <span class="k">def</span> <span class="nf">poweron</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Procedure to turn power on.&quot;&quot;&quot;</span>

        <span class="c1"># You can access the labhost as `self.host` (if you use the</span>
        <span class="c1"># ConsoleConnector).  In this case I have a simple command to</span>
        <span class="c1"># toggle power.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;remote_power&quot;</span><span class="p">,</span> <span class="s2">&quot;bbb&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">)</span>

        <span class="c1"># If you can&#39;t automatically toggle power,</span>
        <span class="c1"># you have to insert some marker here that reminds you</span>
        <span class="c1"># to manually toggle power.  How about:</span>
        <span class="n">tbot</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;Turn power on now!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">poweroff</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Procedure to turn power off.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;remote_power&quot;</span><span class="p">,</span> <span class="s2">&quot;bbb&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mach</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">channel</span><span class="o">.</span><span class="n">Channel</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Connect to the boards serial interface.&quot;&quot;&quot;</span>

        <span class="c1"># `mach.open_channel` &#39;steals&#39; mach&#39;s channel and runs the</span>
        <span class="c1"># given command to connect to the serial console.  Your command</span>
        <span class="c1"># should just connect its tty to the serial console like rlogin,</span>
        <span class="c1"># telnet, picocom or kermit do.  The minicom behavior will not work.</span>
        <span class="k">return</span> <span class="n">mach</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="s2">&quot;picocom&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;115200&quot;</span><span class="p">,</span> <span class="s2">&quot;bbb&quot;</span><span class="p">)</span>

<span class="c1"># tbot will check for `BOARD`, don&#39;t forget to set it!</span>
<span class="n">BOARD</span> <span class="o">=</span> <span class="n">SomeBoard</span>
</pre></div>
</td></tr></table></div>
<p>If you did everything correctly, this should be enough to get a serial connection running.  Try this:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tbot -l lab.py -b my-board.py interactive_board -vv
</pre></div>
</div>
<p>You should see the board starting to boot.  If not, go back and check manually if the commands by
themselves work.  You might also want to look at the <a class="reference internal" href="configuration.html#config-board"><span class="std std-ref">Board Config</span></a> documentation.</p>
<p>Next up we will add config for the Linux running on the board (in the same file for now).  I’ll skip
U-Boot in this quick guide for simplicity.  Here’s the full new config:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>
<span class="kn">from</span> <span class="nn">tbot.machine</span> <span class="kn">import</span> <span class="n">board</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">linux</span>

<span class="k">class</span> <span class="nc">SomeBoard</span><span class="p">(</span>
    <span class="n">connector</span><span class="o">.</span><span class="n">ConsoleConnector</span><span class="p">,</span>
    <span class="n">board</span><span class="o">.</span><span class="n">PowerControl</span><span class="p">,</span>
    <span class="n">board</span><span class="o">.</span><span class="n">Board</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;some-board&quot;</span>

    <span class="k">def</span> <span class="nf">poweron</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;remote_power&quot;</span><span class="p">,</span> <span class="s2">&quot;bbb&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">poweroff</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;remote_power&quot;</span><span class="p">,</span> <span class="s2">&quot;bbb&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mach</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">channel</span><span class="o">.</span><span class="n">Channel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mach</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="s2">&quot;picocom&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;115200&quot;</span><span class="p">,</span> <span class="s2">&quot;bbb&quot;</span><span class="p">)</span>

<span class="c1"># Linux machine</span>
<span class="c1">#</span>
<span class="c1"># We use a config which boots directly to Linux without interaction</span>
<span class="c1"># with a bootloader for this example.</span>
<span class="k">class</span> <span class="nc">SomeBoardLinux</span><span class="p">(</span>
    <span class="n">board</span><span class="o">.</span><span class="n">Connector</span><span class="p">,</span>
    <span class="n">board</span><span class="o">.</span><span class="n">LinuxBootLogin</span><span class="p">,</span>
    <span class="n">linux</span><span class="o">.</span><span class="n">Bash</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># Username for logging in once linux has booted</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span>
    <span class="c1"># Password.  If you don&#39;t need a password, set this to `None`</span>
    <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;~ysu0dbi&quot;</span>

<span class="n">BOARD</span> <span class="o">=</span> <span class="n">SomeBoard</span>
<span class="c1"># You need to set `LINUX` now as well.</span>
<span class="n">LINUX</span> <span class="o">=</span> <span class="n">SomeBoardLinux</span>
</pre></div>
</td></tr></table></div>
<p>Again, adjust it as necessary.  If you are unsure about some parameters, you can check in the
<code class="docutils literal notranslate"><span class="pre">interactive_board</span></code> session.  To learn more about the individual parameters, look at the
<a class="reference internal" href="configuration.html#config-board"><span class="std std-ref">Board Config</span></a> and <a class="reference internal" href="configuration.html#config-board-linux-standalone"><span class="std std-ref">Linux (without U-Boot) Config</span></a> docs.</p>
<p>If you set everything correctly, you should be able to run:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tbot -l lab.py -b my-board.py interactive_linux -vv
</pre></div>
</div>
<p>You now have a shell on the board!  As before, you can also try running a selftest:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tbot -l lab.py -b my-board.py selftest_board_linux -vv
</pre></div>
</div>
<div class="highlight">
<pre>bash-4.4$ tbot -l lab.py -b my-board.py selftest_board_linux -vv
<font color="#F4BF75"><b>tbot</b></font> starting ...
├─Calling <font color="#A1EFE4"><b>selftest_board_linux</b></font> ...
│   ├─Logging in on <font color="#F4BF75">hws@78.79.32.85:22</font> ...
│   ├─[<font color="#F4BF75">awesome-lab</font>] connect bbb
│   ├─[<font color="#F4BF75">awesome-lab</font>] remote_power bbb -l
│   │    ## bbb             off
│   ├─<b>POWERON</b> (bbb)
│   ├─[<font color="#F4BF75">awesome-lab</font>] remote_power bbb on
│   │    ## Power on   bbb: OK
│   ├─<b>UBOOT</b> (bbb-uboot)
│   │    &lt;&gt;
│   │    &lt;&gt; U-Boot 2018.11-00191-gd73d81fd85 (Nov 20 2018 - 06:01:01 +0100)
│   │    &lt;&gt;
│   │    &lt;&gt; CPU  : AM335X-GP rev 2.1
│   │    &lt;&gt; Model: TI AM335x BeagleBone Black
│   │    &lt;&gt; DRAM:  512 MiB
│   │    &lt;&gt; NAND:  0 MiB
│   │    &lt;&gt; MMC:   OMAP SD/MMC: 0, OMAP SD/MMC: 1
│   │    &lt;&gt; Loading Environment from FAT... ** No partition table - mmc 0 **
│   │    &lt;&gt; No USB device found
│   │    &lt;&gt; &lt;ethaddr&gt; not set. Validating first E-fuse MAC
│   │    &lt;&gt; Net:   eth0: ethernet@4a100000
│   ├─<b>LINUX</b> (bbb-linux)
│   ├─[<font color="#F4BF75">bbb-uboot</font>] setenv serverip 192.168.1.1
│   ├─[<font color="#F4BF75">bbb-uboot</font>] setenv netmask 255.255.255.0
│   ├─[<font color="#F4BF75">bbb-uboot</font>] setenv ipaddr 192.168.1.10
│   ├─[<font color="#F4BF75">bbb-uboot</font>] mw 0x81000000 0 0x4000
│   ├─[<font color="#F4BF75">bbb-uboot</font>] setenv rootpath /opt/core-image-lsb-sdk-generic-armv7a-hf
│   ├─[<font color="#F4BF75">bbb-uboot</font>] run netnfsboot
│   │    &lt;&gt; Booting from network ... with nfsargs ...
│   │    &lt;&gt; link up on port 0, speed 100, full duplex
│   │    &lt;&gt; TFTP from server 192.168.1.1; our IP address is 192.168.1.10
│   │    &lt;&gt; Load address: 0x82000000
│   │    &lt;&gt; Loading: #################################################################
│   │    &lt;&gt;    ########################
│   │    &lt;&gt;    2.9 MiB/s
│   │    &lt;&gt; done
│   │    &lt;&gt; Bytes transferred = 9883000 (96cd78 hex)
│   │    &lt;&gt; link up on port 0, speed 100, full duplex
│   │    &lt;&gt; TFTP from server 192.168.1.1; our IP address is 192.168.1.10
│   │    &lt;&gt; Load address: 0x88000000
│   │    &lt;&gt; Loading: #####
│   │    &lt;&gt;    1.1 MiB/s
│   │    &lt;&gt; done
│   │    &lt;&gt; Bytes transferred = 64051 (fa33 hex)
│   │    &lt;&gt; ## Flattened Device Tree blob at 88000000
│   │    &lt;&gt;    Booting using the fdt blob at 0x88000000
│   │    &lt;&gt;    Loading Device Tree to 8ffed000, end 8ffffa32 ... OK
│   │    &lt;&gt;
│   │    &lt;&gt; Starting kernel ...
│   │    &lt;&gt;
│   │    &lt;&gt; [    0.000000] Booting Linux on physical CPU 0x0
│   │    &lt;&gt; [    0.000000] Linux version 4.9.126 (build@denx) (gcc version 7.2.1 20171011 (Linaro GCC 7.2-2017.11) ) #1 SMP PREEMPT Wed Dec 12 03:12:29 CET 2018
│   │    &lt;&gt; [    0.000000] CPU: ARMv7 Processor [413fc082] revision 2 (ARMv7), cr=10c5387d
│   │    &lt;&gt; [    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache                                              Hello there ;)
│   │    &lt;&gt; [    0.000000] OF: fdt:Machine model: TI AM335x BeagleBone Black
│   │    &lt;&gt; [    0.000000] efi: Getting EFI parameters from FDT:
│   │    &lt;&gt; [    0.000000] efi: UEFI not found.
│   │    &lt;&gt; [    0.000000] cma: Reserved 48 MiB at 0x9c800000
[...]
│   │    &lt;&gt; Poky (Yocto Project Reference Distro) 2.4 generic-armv7a-hf /dev/ttyS0
│   │    &lt;&gt;
│   │    &lt;&gt; generic-armv7a-hf login: root
│   ├─Calling <font color="#A1EFE4"><b>selftest_machine_shell</b></font> ...
│   │   ├─Testing command output ...
│   │   ├─[<font color="#F4BF75">bbb-linux</font>] echo &apos;Hello World&apos;
│   │   │    ## Hello World
│   │   ├─[<font color="#F4BF75">bbb-linux</font>] echo &apos;$?&apos; &apos;!#&apos;
│   │   │    ## $? !#
[...]
│   │   └─<font color="#A6E22E"><b>Done</b></font>. (3.355s)
│   ├─<b>POWEROFF</b> (bbb)
│   ├─[<font color="#F4BF75">pollux</font>] remote_power bbb off
│   │    ## Power off  bbb: OK
│   └─<font color="#A6E22E"><b>Done</b></font>. (44.150s)
├─────────────────────────────────────────
└─<font color="#A6E22E"><b>SUCCESS</b></font> (44.624s)</pre>
</div></div>
<div class="section" id="hardware-use-from-tests">
<h2>Hardware Use from Tests<a class="headerlink" href="#hardware-use-from-tests" title="Permalink to this headline">¶</a></h2>
<p>Last part of this guide will be interacting with the board from a testcase.  It’s pretty straight
forward:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">test_board</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Get access to the lab-host as before</span>
    <span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_lab</span><span class="p">()</span> <span class="k">as</span> <span class="n">lh</span><span class="p">:</span>
        <span class="c1"># This context is for the &quot;hardware&quot;.  Once you enter</span>
        <span class="c1"># it, the board will be powered on and as soon as</span>
        <span class="c1"># you exit it, it will be turned off again.</span>
        <span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_board</span><span class="p">(</span><span class="n">lh</span><span class="p">)</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
            <span class="c1"># This is the context for the &quot;Linux machine&quot;.</span>
            <span class="c1"># Entering it means tbot will listen to the</span>
            <span class="c1"># board booting and give you a machine handle</span>
            <span class="c1"># as soon as the shell is available.</span>
            <span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_linux</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">as</span> <span class="n">lnx</span><span class="p">:</span>
                <span class="n">lnx</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;uname&quot;</span><span class="p">,</span> <span class="s2">&quot;-a&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Those two additional indentation levels aren’t nice - We can refactor the code to
look like this (I showed the explicit version first so you can see what is going on):</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tbot</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">test_board</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">with</span>  <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_lab</span><span class="p">()</span> <span class="k">as</span> <span class="n">lh</span><span class="p">,</span>
          <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_board</span><span class="p">(</span><span class="n">lh</span><span class="p">)</span> <span class="k">as</span> <span class="n">b</span><span class="p">,</span>
          <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_linux</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">as</span> <span class="n">lnx</span><span class="p">:</span>
        <span class="n">lnx</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;uname&quot;</span><span class="p">,</span> <span class="s2">&quot;-a&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>There is still one issue with this design:  Let’s pretend this is a test to check some
board functionality.  Maybe you have quite a few testcases that each check different
parts.  Now, we want to call all of them from some “master” test, so we can test everything
at once.</p>
<p>The issue we will run into is that each testcase will A) reconnect to the lab-host and
B) powercycle the board.  This will be very very slow!  We can do better!</p>
<p>The idea is that testcases take the lab and board as optional parameters.  This allows
reusing the old connection and won’t powercycle the board for each test (if you need powercycling,
you can of course do it like above).  To make this as easy as possible, tbot provides the
<code class="xref py py-func docutils literal notranslate"><span class="pre">with_linux()</span></code> decorator.  You can use it like this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">tbot</span>
<span class="kn">from</span> <span class="nn">tbot.machine</span> <span class="kn">import</span> <span class="n">linux</span><span class="p">,</span> <span class="n">board</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="nd">@tbot</span><span class="o">.</span><span class="n">with_linux</span>
<span class="k">def</span> <span class="nf">test_board</span><span class="p">(</span>
    <span class="n">lnx</span><span class="p">:</span> <span class="n">linux</span><span class="o">.</span><span class="n">LinuxShell</span><span class="p">,</span>
    <span class="n">param</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">lnx</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;uname&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">call_it</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_lab</span><span class="p">()</span> <span class="k">as</span> <span class="n">lh</span><span class="p">:</span>
        <span class="n">test_board</span><span class="p">(</span><span class="n">lh</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">)</span>

<span class="nd">@tbot</span><span class="o">.</span><span class="n">testcase</span>
<span class="k">def</span> <span class="nf">call_it_prepared</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_lab</span><span class="p">()</span> <span class="k">as</span> <span class="n">lh</span><span class="p">,</span>
         <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_board</span><span class="p">(</span><span class="n">lh</span><span class="p">)</span> <span class="k">as</span> <span class="n">b</span><span class="p">,</span>
         <span class="n">tbot</span><span class="o">.</span><span class="n">acquire_linux</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">as</span> <span class="n">lnx</span><span class="p">:</span>
        <span class="n">test_board</span><span class="p">(</span><span class="n">lnx</span><span class="p">,</span> <span class="s2">&quot;-n&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>You can still call <code class="docutils literal notranslate"><span class="pre">test_board</span></code> from the commandline, but <code class="docutils literal notranslate"><span class="pre">call_it</span></code> and <code class="docutils literal notranslate"><span class="pre">call_it_prepared</span></code>
work as well!</p>
<p>There is also <code class="xref py py-func docutils literal notranslate"><span class="pre">with_lab()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">with_uboot()</span></code> for those two usecases.</p>
<p>That’s it for the quick-start guide.  If you want to dive deeper, you might want to follow these
links:</p>
<ul class="simple">
<li><p><a class="reference internal" href="modules/machine.html#module-tbot.machine" title="tbot.machine"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tbot.machine</span></code></a> - More machine documentation</p></li>
<li><p><a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration</span></a> - Detailed docs about configuration</p></li>
<li><p><a class="reference internal" href="modules/tc.html#module-tbot.tc" title="tbot.tc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tbot.tc</span></code></a> - Builtin testcases for a variety of jobs</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
    <a href="https://github.com/Rahix/tbot">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>

          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Rahix

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>